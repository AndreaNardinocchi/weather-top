import { userStore } from "../models/user-store.js";


export const accountsController = {
  index(request, response) {
    const viewData = {
      title: "Login or Signup",
    };
    response.render("index", viewData);
  },

  login(request, response) {
    const viewData = {
      title: "Login to the Service",
    };
    response.render("login-view", viewData);
  },

  logout(request, response) {
    response.cookie("station", "");
    response.redirect("/");
  },

  signup(request, response) {
    const viewData = {
      title: "Sign up to the Service",
    };
    response.render("signup-view", viewData);
  },

  account(request, response) {
  
    const viewData = {
      title: "Account",
    };
    response.render("account-view", viewData);
  },
  
    async register(request, response) {
    const user = request.body;
    await userStore.addUser(user);
    console.log(`registering ${user.email}`);
    response.redirect("/");
  },

  
  /*
  So, in your account controller, do you have a method for that account-view page, that acts like the other index methods, e.g. the ones that create the 'viewData' objects and then use response.render() to render the targeted page?


Andrea Nardinocchi
  2 hours ago
I will DM you my code later... (edited) 


Wolfgang Helnwein
  2 hours ago
If so, you need to grab the currently logged in user from the request (which you'll route through your router to this method from the tab in the menu).


Wolfgang Helnwein
  2 hours ago
You can use something like this:
const user = await accountsController.getLoggedInUser(request);


Wolfgang Helnwein
  2 hours ago
Then prepare to populate the viewData object, like so: const firsName = user.firstName.


Wolfgang Helnwein
  2 hours ago
So you can then pass it into the object like this:
const viewData = {
            title: "Account Settings",
            firstName: firstName,
            ...


Wolfgang Helnwein
  2 hours ago
And then use the same response.render() method to pass in the viewData object to your view.


Wolfgang Helnwein
  2 hours ago
So can then use things like: {{firstName}} in your handlebars partial.
  */
    async account(request, response) {
    const user = await accountsController.getLoggedInUser(request); 
    const firstName = user.firstName;
    const lastName = user.lastName;
    const email = user.email;
    const password = user.password;
    const _id = user._id;
    
    
    const viewData = {
      title: "Account",
      firstName: firstName,
      lastName: lastName,
      email: email,
      password: password,
      _id: user._id,
      
    };
    response.render("account-view", viewData);
  },
  
  
   async update(request, response) {
   console.log(request.body);
   const userId = request.params.userid;
   const user = await accountsController.getUserById(userId);
     
   const firstName = request.body.firstName;
   const lastName = request.body.lastNam;
   const email = request.body.email;
   const password = request.body.password;
   const _id = userId;
   
    const updatedUser = {
        firstName: firstName,
        lastName: lastName,
        email: email,
        password: password,
        _id: userId,
     };
    
    console.log(`Updating User ${userId}`);
    await userStore.updateUser(user, updatedUser);
    response.redirect("/account/" + userId);
     
  },

  async authenticate(request, response) {
    const user = await userStore.getUserByEmail(request.body.email);
    if (user) {
      response.cookie("station", user.email);
      console.log(`logging in ${user.email}`);
      response.redirect("/dashboard");
    } else {
      response.redirect("/login");
    }
  },

  async getLoggedInUser(request) {
    const userEmail = request.cookies.station;
    return await userStore.getUserByEmail(userEmail);
  },  
  
};
